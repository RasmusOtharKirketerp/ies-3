<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ user_id }}-NewsRoom</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
    <link href="/static/style.css" rel="stylesheet">
</head>

<body class="container-fluid">
    <div id="weather-ticker" class="weather-ticker">
        <span class="weather-ticker-inner" id="weather-ticker-inner">Loading weather...</span>
    </div>
    <div id="xolta-ticker" class="xolta-ticker">
        <span class="xolta-ticker-inner" id="xolta-ticker-inner">Loading Xolta data...</span>
    </div>
    <h1 class="mt-4">{{ user_id }}-NewsRoom</h1>
    <div class="progress mb-3" style="height: 8px;">
        <div id="reload-progress" class="progress-bar bg-info" role="progressbar" style="width: 100%;"
            aria-valuenow="100" aria-valuemin="0" aria-valuemax="100"></div>
    </div>
    <div class="button-container mb-3">
        <a href="/" class="btn btn-success me-2 mb-2" title="All Articles"><i class="bi bi-newspaper"></i></a>
        <a href="/today" class="btn btn-success me-2 mb-2" title="Today's Articles"><i
                class="bi bi-calendar-day"></i></a>
        <a href="/timeline" class="btn btn-primary me-2 mb-2" title="Timeline View"><i
                class="bi bi-clock-history"></i></a>
        <a href="/words" class="btn btn-primary me-2 mb-2" title="Manage Words"><i class="bi bi-book"></i></a>
        <a href="/original" class="btn btn-primary me-2 mb-2" title="Original Text"><i class="bi bi-card-text"></i></a>
        <a href="/websites" class="btn btn-primary me-2 mb-2" title="Manage Websites"><i class="bi bi-globe"></i></a>
        <a href="/status" class="btn btn-primary me-2 mb-2" title="System Status"><i class="bi bi-graph-up"></i></a>
        <button id="resetHiddenBtn" class="btn btn-primary me-2 mb-2" type="button" onclick="resetHiddenArticles()"
            title="Show all hidden articles">
            <i class="bi bi-arrow-counterclockwise"></i>
        </button>
        <button id="markAllReadBtn" class="btn btn-primary me-2 mb-2" type="button" onclick="markAllRead()"
            title="Mark all articles as read">
            <i class="bi bi-eye-slash"></i>
        </button>
        <div class="form-check form-switch d-inline-block ms-3">
            <input class="form-check-input" type="checkbox" id="viewSwitch">
            <label class="form-check-label" for="viewSwitch">Compact View</label>
        </div>
        <div class="form-check form-switch d-inline-block ms-3">
            <input class="form-check-input" type="checkbox" id="pictureSwitch">
            <label class="form-check-label" for="pictureSwitch">Show Pictures</label>
        </div>
        <div class="form-check form-switch d-inline-block ms-3">
            <input class="form-check-input" type="checkbox" id="darkModeSwitch">
            <label class="form-check-label" for="darkModeSwitch">Dark Mode</label>
        </div>

    </div>

    <div class="row">
        {% for title, text, top_image, url, base_url, score, publish_date in articles %}
        <div class="col-12 article-card" data-article-url="{{ url }}">
            <div class="card">
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-3">
                            {% if top_image %}
                            <a href="{{ url }}" target="_blank">
                                <img src="{{ top_image }}" alt="Article image" class="article-image img-fluid">
                            </a>
                            {% endif %}
                        </div>
                        <div class="col-md-9">
                            <h5 class="card-title">{{ title }}</h5>
                            <div class="article-meta">
                                <img src="{{ get_google_favicon(base_url) }}" alt="Favicon" class="favicon">
                                <small class="text-muted">
                                    {{ publish_date }}
                                    <span class="ms-2" data-publish-date="{{ publish_date }}"></span>
                                </small>
                                <span class="badge bg-{{ 'success' if score is not none and score > 0 else 'danger' }}">
                                    Score: {{ "%.2f"|format(score) if score is not none else "N/A" }}
                                </span>
                            </div>
                            <p class="card-text">{{ text }}</p>
                            <a href="{{ url }}" target="_blank" class="btn btn-sm btn-outline-primary">Read More</a>
                        </div>
                    </div>
                    <button class="remove-article-btn" title="Remove this article" onclick="removeArticle(this)">
                        &times;
                    </button>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/static/index.js"></script>
    <script src="/static/weather.js"></script>
    <script src="/static/xolta.js"></script>
    <script>
        // Show time since published for each article
        document.addEventListener('DOMContentLoaded', function () {
            document.querySelectorAll('[data-publish-date]').forEach(function (el) {
                const dateStr = el.getAttribute('data-publish-date');
                if (!dateStr) return;
                // Try to parse as local or UTC
                let dt = new Date(dateStr.replace(' ', 'T'));
                if (isNaN(dt)) dt = new Date(dateStr);
                if (isNaN(dt)) return;
                const now = new Date();
                let diff = Math.floor((now - dt) / 1000); // seconds
                if (diff < 0) return;
                const days = Math.floor(diff / 86400);
                diff %= 86400;
                const hours = Math.floor(diff / 3600);
                diff %= 3600;
                const minutes = Math.floor(diff / 60);
                let parts = [];
                if (days > 0) parts.push(days + 'd');
                if (hours > 0 || days > 0) parts.push(hours + 'h');
                parts.push(minutes + 'm');
                el.textContent = '(' + parts.join(' ') + ' siden)';
            });
        });
    </script>
</body>

</html>